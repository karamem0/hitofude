name: Test source

description: This GitHub Action tests sources and uploads reports

runs:
  using: composite
  steps:
    - name: Checkout repos
      uses: actions/checkout@v4
    - name: Setup Node.js 22.x
      uses: actions/setup-node@v4
      with:
        node-version: 22.x
    - name: Restore source
      shell: pwsh
      run: npm ci
    - name: Audit source
      shell: pwsh
      run: npm audit --omit=dev
    - name: Test source
      shell: pwsh
      run: npm run test:ci
    - name: Upload test results
      uses: enricomi/publish-unit-test-result-action/linux@3a74b2957438d0b6e2e61d67b05318aa25c9e6c6
      if: always()
      with:
        files: test/*.xml
        check_name: Test results
    - name: Upload coverage reports
      uses: codecov/codecov-action@5a1091511ad55cbe89839c7260b706298ca349f7
      if: always()
      with:
        fail_ci_if_error: true
        token: ${{env.CODECOV_TOKEN}}
        slug: karamem0/hitofude
